tail(primary)
tail(second)
length(bonus_penalty2)
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
income_data <- data.frame(primary,second,total_income,indv1_contrib)
names(income_data)
library(dplyr)
income_data2 <- subset(income_data, indv1_contrib <= 0.5)
source('~/R/Projects/Tax Project/Tax_data2.R')
Heatmap(income_data2$bonus,
saf
#Create new matrix for heatmap
percent_map <- as.matrix(cbind(income_data2$indv1_contrib, income_data2$bonus)
#Create new matrix for heatmap
percent_map <- as.matrix(cbind(income_data2$indv1_contrib, income_data2$bonus))
#Create new matrix for heatmap
percent_map <- matrix(income_data2, nrow=lenth(indv1))
#Create new matrix for heatmap
percent_map <- matrix(income_data2, nrow=length(indv1))
#Create new matrix for heatmap
percent_map <- matrix(income_data2$bonus, nrow=length(indv1))
head(percent_map)
#Create new matrix for heatmap
percent_map <- matrix(income_data2$bonus, ncol=length(indv1))
#Create new matrix for heatmap
percent_map <- matrix(income_data2$bonus, nrows=length(indv1))
#Create new matrix for heatmap
percent_map <- matrix(income_data2$bonus, nrow=length(indv1))
source('~/R/Projects/Tax Project/Tax_data2.R')
income_data2 <- subset(income_data, indv1_contrib <= 0.5)
#Create new matrix for heatmap
percent_map <- matrix(income_data2$bonus, ncol=length(indv1))
dim(percent_map)
source("Tax_data2.R")
tail(income_data2)
class(income_data2$second)
class(income_data$primary)
length(indv1)
38 * 38
741 / 38
head(income_data)
#Create new matrix for heatmap
bonus_map <- matrix(income_data$bonus, nrow = length(indv1))
#Create new matrix for heatmap
bonus_percent <- matrix(income_data$bonus, nrow = length(indv1))
colnames(bonus_percent) <- income_data$indv1_contrib
rownames(bonus_percent) <- sprintf("%sK", seq(from=(indv1_low/1000), to=(indv1_high/1000), by=(increment/1000)))
rownames(bonus_percent)
#Create dataframe
income_data <- data.frame(primary,second,total_income,indv1_contrib, bonus) %>% filter(indv1_contrib >= 0.5)
summary(income_data)
#Create dataframe
income_data <- data.frame(primary,second,total_income,indv1_contrib, bonus) %>% filter(indv1_contrib <= 0.5)
summary(income_data)
filter(income_data, indv1_contrib = 0.5)
filter(income_data, indv1_contrib == 0.5)
tail(bonus_penalty)
view(income_data)
view("income_data")
?view
view income_data
view(income_data)
class(income_data)
view(income_data)
head(income_data)
rownames(bonus_percent) <- sprintf("%sK", income_data$primary)
unique(income_data$primary)
#Create new matrix for heatmap
bonus_percent <- matrix(income_data$bonus, nrow = length(unique(income_data$primary))
#Create new matrix for heatmap
bonus_percent <- matrix(income_data$bonus, nrow = length(unique(income_data$primary))
#Create new matrix for heatmap
bonus_percent <- matrix(income_data$bonus, nrow = length(unique(income_data$primary)))
length(unique(income_data$primary))
head(bonus_percent)
tail(bonus_percent)
head(income_data)
#Create dataframe, filter for one sided (contribution <= 50%), arrnage by percent contribution
income_data <- data.frame(primary,second,total_income,indv1_contrib, bonus) %>%
filter(indv1_contrib <= 0.5) %>%
arrange(indv1_contrib)
head(income_data)
tail(income_data)
#Create new matrix for heatmap
bonus_percent <- matrix(income_data$bonus, nrow = length(unique(income_data$primary)))
rownames(bonus_percent) <- sprintf("%sK", income_data$primary)
p <- ggplot(income_data, aes(x=indv1_contrib, y=bonus))
library(tidyverse)
p <- ggplot(income_data, aes(x=indv1_contrib, y=bonus))
p + geom_density()
p + geom_bar()
head(bonus_percent)
head(income_data)
p + geom_point()
p + geom_point(aes(color=primary))
?rbind
#Create dataframe, filter for one sided (contribution <= 50%), arrnage by percent contribution
income_data <- data.frame(primary,second,total_income,indv1_contrib, bonus) %>%
filter(indv1_contrib <= 0.5) %>%
arrange(indv1_contrib) %>%
group_by(primary)
summarise(income_data)
summarise(income_data, mean <- (mean(bonus)))
#Create dataframe, filter for one sided (contribution <= 50%), arrnage by percent contribution
income_data <- data.frame(primary,second,total_income,indv1_contrib, bonus) %>%
filter(indv1_contrib <= 0.5) %>%
arrange(indv1_contrib) %>%
group_by(primary, indv1_contrib)
summarise(income_data, mean <- (mean(bonus)))
#Create dataframe, filter for one sided (contribution <= 50%), arrnage by percent contribution
income_data <- data.frame(primary,second,total_income,indv1_contrib, bonus) %>%
filter(indv1_contrib <= 0.5) %>%
arrange(indv1_contrib) %>%
group_by(primary)
summarise(income_data, indiv1_contrib <- indiv1_contrib, bonus <- bonus)
groups(income_data)
?model.matrix
?gather
view(income_data)
#Create dataframe, filter for one sided (contribution <= 50%), arrnage by percent contribution
income_data <- data.frame(primary,second,total_income,indv1_contrib, bonus) %>%
filter(indv1_contrib <= 0.5) %>%
arrange(indv1_contrib, primary)
view(income_data)
#Create dataframe, filter for one sided (contribution <= 50%), arrnage by percent contribution
income_data <- data.frame(primary,second,total_income,indv1_contrib, bonus) %>%
filter(indv1_contrib <= 0.5) %>%
arrange(primary)
view(income_data)
#Create new matrix for heatmap
bonus_percent <- matrix(income_data$bonus, nrow = length(unique(income_data$primary)))
view(bonus_percent)
view(income_data)
test <- spread(income_data, key="primary", value="bonus")
view(test)
test <- spread(income_data, key="primary", value="bonus", -second, -total_income)
?spread
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus")
view(bonus_percent)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus", drop=FALSE)
view(bonus_percent)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus", drop=TRUE)
view(bonus_percent)
class(bonus_percent)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus") %>%
select(indv1_low:indv1_high)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus") %>%
rownames(indv1_contrib)
rownames(bonus_percent)
rownames(bonus_percent) <- bonus_percent$indv1_contrib
bonus_percent$indv1_contrib
names(bonus_percent)
colnames(bonus_percent)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus")
names(bonus_percent)
rownames(bonus_percent) <- bonus_percent$indv1_contrib
view(bonus_percent)
bonus_percent_map <- as.matrix(select(bonus_percent, -indv1_contrib))
source("Tax_data2.R")
source('~/R/Projects/Tax Project/Tax_data2.R')
view(bonus_percent_map)
?round
#Fixing row names
rownames(bonus_percent) <- round((bonus_percent$indv1_contrib*100), digits=2)
view(bonus_percent_map)
source('~/R/Projects/Tax Project/Tax_data2.R')
view(bonus_percent_map)
round(2.4234234, digits=0)
source('~/R/Projects/Tax Project/Tax_data2.R')
view(bonus_percent)
source('~/R/Projects/Tax Project/Tax_data2.R')
view(bonus_percent)
source('~/R/Projects/Tax Project/Tax_data2.R')
view(bonus_percent)
income_data$indv1_contrib <- round((income_data$indv1_contrib*100), digits=0)
view(income_data)
source('~/R/Projects/Tax Project/Tax_data2.R')
view(income_data)
filter(income_data, indv1_contrib ==43)
filter(income_data, indv1_contrib ==35)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus")
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="indv1_contrib", value="bonus")
filter(income_data, primary=30000, indv1_contrib = 50)
filter(income_data, primary==30000, indv1_contrib == 50)
filter(income_data, primary==30000, indv1_contrib == 20)
filter(income_data, primary==30000, indv1_contrib == 15)
income_data$indv1_contrib <- round((income_data$indv1_contrib*100), digits=1)
filter(income_data, primary==30000, indv1_contrib == 15)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus")
view(income_data)
source('~/R/Projects/Tax Project/Tax_data2.R')
view(income_data)
unique(income_data$indv1_contrib)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus")
view(bonus_percent)
#Create new matrix for heatmap
bonus_percent <- select(income_data, primary, indv1_contrib, bonus) %>%
spread(key="primary", value="bonus", fill=0)
view(bonus_percent)
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
?gpar
?rep
rep(1:4, 2)
c(rep("black", rep("white", 5), length(indv1))
c(rep("black", rep("white", 5), length(indv1))))
c(rep("black", rep("white", 5), length(indv1)))
c(rep(c("black", rep("white", 4)), 10))
c(rep(c("black", rep("white", 4)), lenght(indv1)))
c(rep(c("black", rep("white", 4)), length(indv1)/5))
c(rep(c("black", rep("white", 3), "black")
c(rep(c("black", rep("white", 3), "black"), length(indv1)/5))
htmp_bonus <- Heatmap(bonus_penalty,
cluster_columns=FALSE,
column_title = "Marriage Tax Bonus: Joint Filing vs Single Filing",
cluster_rows=FALSE,
row_names_gp = gpar( col =
c(
rep(
c("black", rep("white", 3), "black"), (length(indv1)/5)      #Whites out labels bewtween 1 and 5
)
)
)
name = "Bonus $",
col= c("Red", "yellow", "greenyellow", "green", "cyan", "blue")
)
htmp_bonus <- Heatmap(bonus_penalty,
cluster_columns=FALSE,
column_title = "Marriage Tax Bonus: Joint Filing vs Single Filing",
cluster_rows=FALSE,
row_names_gp = gpar( col =
c(
rep(
c("black", rep("white", 3), "black"), (length(indv1)/5)      #Whites out labels bewtween 1 and 5
)
)
),
name = "Bonus $",
col= c("Red", "yellow", "greenyellow", "green", "cyan", "blue")
)
#png(file="htmp_bonus.png")
draw(htmp_bonus)
htmp_bonus <- Heatmap(bonus_penalty,
cluster_columns=FALSE,
column_title = "Marriage Tax Bonus: Joint Filing vs Single Filing",
cluster_rows=FALSE,
row_names_gp = gpar( col =
c(
rep(
c("black", rep("white", 3)), (length(indv1)/5)      #Whites out labels bewtween 1 and 5
)
)
),
name = "Bonus $",
col= c("Red", "yellow", "greenyellow", "green", "cyan", "blue")
)
#png(file="htmp_bonus.png")
draw(htmp_bonus)
htmp_bonus <- Heatmap(bonus_penalty,
cluster_columns=FALSE,
column_title = "Marriage Tax Bonus: Joint Filing vs Single Filing",
cluster_rows=FALSE,
row_names_gp = gpar( col =
c(
rep(
c("black", rep("white", 3)), (length(indv1)/4)      #Whites out labels bewtween 1 and 5
)
)
),
name = "Bonus $",
col= c("Red", "yellow", "greenyellow", "green", "cyan", "blue")
)
#png(file="htmp_bonus.png")
draw(htmp_bonus)
htmp_bonus <- Heatmap(bonus_penalty,
cluster_columns=FALSE,
column_title = "Marriage Tax Bonus: Joint Filing vs Single Filing",
cluster_rows=FALSE,
row_names_gp = gpar( col =
c(
rep(
c("black", rep("white", 3)), (length(indv1)/4)      #Whites out labels bewtween 1 and 5
)
)
),
col_names_gp = gpar( col =
c(
rep(
c("black", rep("white", 3)), (length(indv1)/4)      #Whites out labels bewtween 1 and 5
)
)
),
name = "Bonus $",
col= c("Red", "yellow", "greenyellow", "green", "cyan", "blue")
)
htmp_bonus <- Heatmap(bonus_penalty,
cluster_columns=FALSE,
column_title = "Marriage Tax Bonus: Joint Filing vs Single Filing",
cluster_rows=FALSE,
row_names_gp = gpar( col =
c(
rep(
c("black", rep("white", 3)), (length(indv1)/4)      #Whites out labels bewtween 1 and 5
)
)
),
column_names_gp = gpar( col =
c(
rep(
c("black", rep("white", 3)), (length(indv1)/4)      #Whites out labels bewtween 1 and 5
)
)
),
name = "Bonus $",
col= c("Red", "yellow", "greenyellow", "green", "cyan", "blue")
)
#png(file="htmp_bonus.png")
draw(htmp_bonus)
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
view(bonus_penalty)
source('~/R/Projects/Tax Project/Tax_data2.R')
view(bonus_percent_map)
view(inocome_data)
view(income_data)
view(income_data)
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
dev.off()
rm(list=ls())
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
dev.off()
source('~/R/Projects/Tax Project/Tax_data2.R')
dev.off()
source('~/R/Projects/Tax Project/Tax_data2.R')
filter(income_data, primary == 200000)
dev.off()
source('~/R/Projects/Tax Project/Tax_data2.R')
filter(income_data, primary == 200000)
summary(income_data)
summary(bonus_penalty)
summary(bonus_penalty2)
#The goal of this project is to create a heatmap of tax filings for two individuals with varying gross income levels
#It provides heatmaps for both single filing and married filing status as well as the "marriage bonus"
#Jrose 23May19
#Clear workspace
rm(list=ls())
#Load Packages
library(ComplexHeatmap)
library(circlize)
library(tidyverse)
#Creating variables for range of incomes
indv1_low <- 15000
indv1_high <- 200000
indv2_low <- 15000
indv2_high <- 200000
increment <- 5000
#Create vectors of individual gross income possibilities
indv1 <- seq(from=indv1_low, to=indv1_high, by=increment)
indv2 <- seq(from=indv2_low, to=indv2_high, by=increment)
#Adjusted gross income calculation (assumes standard deduction of $12,000 per individual)
std_deduct <- 12000
agi_indv1 <- indv1 - std_deduct
agi_indv2 <- indv2 - std_deduct
#Source functions single_tax.R and joint_tax.R for amount owed in single filing and married joint filings
source("single_tax.R")
source("joint_tax.R")
#Apply joint_tax function to create a matrix of joint tax amount totals
joint_tax_totals <- sapply(1:length(agi_indv2), function(n)
c(sapply((agi_indv1 + agi_indv2[n]), joint_tax))
)
colnames(joint_tax_totals) <- sprintf("%sK", seq(from=(indv1_low/1000), to=(indv1_high/1000), by=(increment/1000)))
rownames(joint_tax_totals) <- sprintf("%sK", seq(from=(indv2_low/1000), to=(indv2_high/1000), by=(increment/1000)))
#Apply single_tax function to create matrix of single tax amount totals
single_tax_totals <- sapply(1:length(agi_indv2), function(n)
c(sapply(agi_indv1, single_tax) + sapply(agi_indv2[n], single_tax))
)
colnames(single_tax_totals) <- sprintf("%sK", seq(from=(indv1_low/1000), to=(indv1_high/1000), by=(increment/1000)))
rownames(single_tax_totals) <- sprintf("%sK", seq(from=(indv2_low/1000), to=(indv2_high/1000), by=(increment/1000)))
#heatmaps of total federal tax
htmp_single <- Heatmap(single_tax_totals,
column_title = "Total Tax--Single Filing",
cluster_columns=FALSE,
cluster_rows=FALSE,
name = "Tax Owed"
)
htmp_joint <- Heatmap(joint_tax_totals,
column_title = "Total Tax--Joint Filing",
cluster_columns=FALSE,
cluster_rows=FALSE,
name = "Tax Owed"
)
#png(file="htmp_sing.png")
draw(htmp_single)
#dev.off()
#png(file="htmp_joint.png")
draw(htmp_joint)
#dev.off()
#Calculate 'marriage bonus/penalty' amounts & plot heatmap
bonus_penalty <- single_tax_totals - joint_tax_totals
htmp_bonus <- Heatmap(bonus_penalty,
cluster_columns=FALSE,
column_title = "Marriage Tax Bonus: Joint Filing vs Single Filing",
cluster_rows=FALSE,
row_names_gp = gpar(col =
c(
rep(
c("black", rep("white", 3)), (length(indv1)/4)      #Whites out labels bewtween 1 and 5
)
)
),
column_names_gp = gpar(col =
c(
rep(
c("black", rep("white", 3)), (length(indv1)/4)      #Whites out labels bewtween 1 and 5
)
)
),
name = "Bonus $",
col= c("Red", "yellow", "greenyellow", "green", "cyan", "blue")
)
#png(file="htmp_bonus.png")
draw(htmp_bonus)
#dev.off()
summary(bonus_penalty)
view(bonus_penalty)
source('~/R/Projects/Tax Project/Tax_data2.R')
dev.off()
source('~/R/Projects/Tax Project/Tax_data2.R')
install.packages("plotly")
library(plotly)
p <- plot_ly(z = bonus_percent_map, type="heatmap")
p
p <- plot_ly(z = bonus_penalty, type="heatmap")
p
p <- plot_ly(x=colnames(bonus_penalty), y=rownames(bonus_penalty), z = bonus_penalty, type="heatmap")
p
source('~/R/Projects/Tax Project/Tax_data2.R')
source("Tax_data2.R")
sprintf("%sK", seq(from=1, to=10, by=1))
sprintf("patients%", seq(from=1, to=10, by=1))
sprintf("%patients%", seq(from=1, to=10, by=1))
sprintf("%spatients", seq(from=1, to=10, by=1))
?sprintf
sprintf("spatients%", seq(from=1, to=10, by=1))
sprintf("%spatients%", seq(from=1, to=10, by=1))
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
View(bonus_percent)
View(bonus_percent_map)
?arrange
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data2.R')
source('~/R/Projects/Tax Project/Tax_data3.R')
source('~/R/Projects/Tax Project/Tax_data3.R')
source('~/R/Projects/Tax Project/Tax_data3.R')
source('~/R/Projects/Tax Project/Tax_data3.R')
?desc
source('~/R/Projects/Tax Project/Tax_data3.R')
view(M_total_income)
source('~/R/Projects/Tax Project/Tax_data3.R')
source('~/R/Projects/Tax Project/Tax_data3.R')
source('~/R/Projects/Tax Project/Tax_data3.R')
filter(income_data, bonus == 0)
dim(income_data)
head(income_data)
filter(income_data, bonus <= 5)
filter(income_data, bonus <= -1)
filter(income_data, bonus <= -0)
filter(income_data, bonus <= 0)
source('~/R/Projects/Tax Project/Tax_data3.R')
